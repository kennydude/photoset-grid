/**
 * photoset-grid - v1.0.0
 * 2014-04-07
 * jQuery plugin to arrange images into a flexible grid
 * http://stylehatch.github.com/photoset-grid/
 *
 * Copyright 2014 Jonathan Moore - Style Hatch
 */
(function(t,i,e,s){"use strict";function o(i,e){this.element=i,this.options=t.extend({},n,e),this._defaults=n,this._name=a,this.init()}var a="photosetGrid",n={width:"100%",gutter:"0px",highresLinks:!1,lowresWidth:500,rel:"",onInit:function(){},onComplete:function(){}};o.prototype={init:function(){this.options.onInit(),this._setupRows(this.element,this.options),this._setupColumns(this.element,this.options)},_callback:function(){this.options.onComplete()},_setupRows:function(i,e){if(e.layout)this.layout=e.layout;else if(t(i).attr("data-layout"))this.layout=t(i).attr("data-layout");else{for(var s="",o=1,a=0;t(i).find("img").length>a;a++)s+=""+o;this.layout=s}this.rows=this.layout.split("");for(var n in this.rows)this.rows[n]=parseInt(this.rows[n],10);var r=t(i).find("img"),h=0;t.each(this.rows,function(t,i){var e=h,s=h+i;r.slice(e,s).wrapAll('<div class="photoset-row cols-'+i+'"></div>'),h=s}),t(i).find(".photoset-row:not(:last-child)").css({"margin-bottom":e.gutter})},_setupColumns:function(e,s){var o=this,a=function(){function o(){var i=""+t(e).width();i!==t(e).attr("data-width")&&(a.each(function(){var e=t(this).find("img:eq(0)"),o=t(t(".photoset-cell",this).get(0)).data("multiplier"),a=i*o;console.log(a),t(this).find("img").each(function(){var i=t(this);p(i,a,o)<p(e,a,o)&&(e=t(this)),i.width()>s.lowresWidth&&i.attr("data-highres")&&i.attr("src",i.attr("data-highres"))});var n=p(e,a,o),r=Math.floor(.025*n);t(this).height(n-r),t(this).find("img").each(function(){var i=.5*(n-p(this,a,o))+"px";t(this).css({"margin-top":i})})}),t(e).attr("data-width",i))}var a=t(e).find(".photoset-row"),n=t(e).find("img");s.highresLinks?(n.each(function(){var i;i=t(this).attr("data-highres")?t(this).attr("data-highres"):t(this).attr("src"),t(this).wrapAll('<a href="'+i+'" class="photoset-cell highres-link" />')}),s.rel&&n.parent().attr("rel",s.rel)):n.each(function(){t(this).wrapAll('<div class="photoset-cell" />')});var r=t(e).find(".photoset-cell"),h=t(e).find(".cols-1 .photoset-cell"),l=t(e).find(".cols-2 .photoset-cell"),d=t(e).find(".cols-3 .photoset-cell"),c=t(e).find(".cols-4 .photoset-cell"),u=t(e).find(".cols-5 .photoset-cell");t(e).css({width:s.width}),a.css({clear:"left",display:"block",overflow:"hidden"}),r.css({"float":"left",display:"block","line-height":"0","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"}),n.css({width:"100%",height:"auto"}),h.css({width:"100%"}).data("multiplier",1),l.css({width:"50%"}).data("multiplier",.5),d.css({width:"33.3%"}).data("multiplier",.33),c.css({width:"25%"}).data("multiplier",.25),u.css({width:"20%"}).data("multiplier",.2);var f=parseInt(s.gutter,10);t(e).find(".photoset-cell:not(:last-child)").css({"padding-right":f/2+"px"}),t(e).find(".photoset-cell:not(:first-child)").css({"padding-left":f/2+"px"});var p=null;p=t("img",e).attr("data-width")?function(i,e){var s=t(i).data("width"),o=t(i).data("height"),a=e/s;return o*a}:function(i){return t(i).height()},o(),t(i).on("resize",function(){o()})};t("img",e).attr("data-width")?a():t(e).imagesLoaded(function(){a(),o._callback()})}},t.fn[a]=function(i){return this.each(function(){t.data(this,"plugin_"+a)||t.data(this,"plugin_"+a,new o(this,i))})};var r="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";t.fn.imagesLoaded=function(i){function e(){var e=t(u),s=t(f);h&&(f.length?h.reject(d,e,s):h.resolve(d)),t.isFunction(i)&&i.call(n,d,e,s)}function o(t){a(t.target,"error"===t.type)}function a(i,s){i.src!==r&&-1===t.inArray(i,c)&&(c.push(i),s?f.push(i):u.push(i),t.data(i,"imagesLoaded",{isBroken:s,src:i.src}),l&&h.notifyWith(t(i),[s,d,t(u),t(f)]),d.length===c.length&&(setTimeout(e),d.unbind(".imagesLoaded",o)))}var n=this,h=t.isFunction(t.Deferred)?t.Deferred():0,l=t.isFunction(h.notify),d=n.find("img").add(n.filter("img")),c=[],u=[],f=[];return t.isPlainObject(i)&&t.each(i,function(t,e){"callback"===t?i=e:h&&h[t](e)}),d.length?d.bind("load.imagesLoaded error.imagesLoaded",o).each(function(i,e){var o=e.src,n=t.data(e,"imagesLoaded");return n&&n.src===o?(a(e,n.isBroken),s):e.complete&&e.naturalWidth!==s?(a(e,0===e.naturalWidth||0===e.naturalHeight),s):((e.readyState||e.complete)&&(e.src=r,e.src=o),s)}):e(),h?h.promise(n):n};var h,l,d,c=t.event,u={_:0},f=0;h=c.special.throttledresize={setup:function(){t(this).on("resize",h.handler)},teardown:function(){t(this).off("resize",h.handler)},handler:function(i,e){var s=this,o=arguments;l=!0,d||(setInterval(function(){f++,(f>h.threshold&&l||e)&&(i.type="throttledresize",c.dispatch.apply(s,o),l=!1,f=0),f>9&&(t(u).stop(),d=!1,f=0)},30),d=!0)},threshold:0}})(jQuery,window,document);